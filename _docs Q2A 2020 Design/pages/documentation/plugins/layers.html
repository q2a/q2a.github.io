
<!doctype html>

<html class="no-js" lang="en">

<head>
	
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	
	<!-- Disable screen scaling-->
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, user-scalable=0"/>

	<!-- Page Title Here -->
	<title>Plugin layers (Documentation) - Question2Answer</title>
	<meta name="description" content=="Implementing plugin layers"/>
	<link rel="canonical" href="http://docs.question2answer.org/pages/documentation/plugins/layers"/>
	
	<!-- Favicons -->
	<link href="../../../images/branding/q2a_96px.png" rel="apple-touch-icon" sizes="96x96" type="image/png">
	<link href="../../../images/branding/q2a_96px.png" rel="icon" sizes="96x96" type="image/png">
	<link href="../../../images/branding/favicon.ico" rel="icon" sizes="16x16" type="image/ico">

	<!-- Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
	<!-- Main CSS files -->
	<link rel="stylesheet" href="../../../css/styles.css"/>
	<link rel="stylesheet" href="../../../css/highlight.css">

	<!-- JS files -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>

<body id="body" class="page">

	<!-- Top Bar -->
	<div id="topBar" class="topBar">
		<div class="topBar-wrapper flex-row">
			<div class="flex-item not-flex-middle">
				<div id="navTrigger" class="material-icons mobile-only">menu</div>
				<a href="https://heliochun.github.io/q2adocs" class="topBarLogo">
					<img src="../../../images/branding/question2answer-logo-350x40.png" class="logo-img normal-logo" />
					<img src="../../../images/branding/question2answer-logo-white-350x40.png" class="logo-img white-logo" />
				</a>
			</div>
			<div id="mobileNav" class="flex-item flex-middle">
				<nav class="main-nav">
					<ul class="nav">
						<li>
							<span class="nav-item selected-nav">Documentation <span class="material-icons">arrow_drop_down</span> </span>
							<ul class="sub-nav display-none">
								<li><a href="https://docs.question2answer.org/pages/documentation/install" class="sub-nav-item">Install</a></li>
								<li><a href="https://docs.question2answer.org/pages/documentation/themes" class="sub-nav-item">Themes</a></li>
								<li><a href="https://docs.question2answer.org/pages/documentation/plugins" class="sub-nav-item selected-nav">Plugins</a></li>
								<li><a href="https://docs.question2answer.org/pages/documentation/code" class="sub-nav-item">Code</a></li>
							</ul>
						</li>
						<li><a href="https://docs.question2answer.org/pages/contribute" class="nav-item">Contribute</a></li>
						<li><a href="https://docs.question2answer.org/pages/translate" class="nav-item">Translate</a></li>
						<li>
							<span class="nav-item">Addons <span class="material-icons">arrow_drop_down</span> </span>
							<ul class="sub-nav display-none">
								<li><a href="https://docs.question2answer.org/pages/addons/themes" class="sub-nav-item">Themes</a></li>
								<li><a href="https://docs.question2answer.org/pages/addons/plugins/" class="sub-nav-item">Plugins</a></li>
								<li><a href="https://docs.question2answer.org/pages/addons/clients/" class="sub-nav-item">Clients</a></li>
								<li><a href="https://docs.question2answer.org/pages/addons/translations/" class="sub-nav-item">Translations</a></li>
							</ul>
						</li>
					</ul>
					<ul class="nav secondary-nav mobile-only">
						<li><a href="https://docs.question2answer.org/pages/services" class="nav-item">Services</a></li>
						<li><a href="https://docs.question2answer.org/pages/sites" class="nav-item">Sites</a></li>
						<li><a href="https://www.question2answer.org/qa" class="nav-item">Q&amp;A</a></li>
					</ul>
				</nav>
			</div>
			<div class="flex-item not-flex-middle not-mobile">
				<ul class="nav secondary-nav">
					<li><a href="https://docs.question2answer.org/pages/services" class="nav-item">Services</a></li>
					<li><a href="https://docs.question2answer.org/pages/sites" class="nav-item">Sites</a></li>
					<li><a href="https://www.question2answer.org/qa" class="nav-item">Q&amp;A</a></li>
				</ul>
			</div>
			<div id="darkPane"></div>
		</div>
	</div>
	
	<!-- Breadcrumbs -->
	<div class="breadcrumbs-container">
		<ul class="breadcrumbs">
			<li class="breadcrumb-item">Documentation</li>
			<li class="breadcrumb-item"><a href="https://docs.question2answer.org/pages/documentation/plugins">Plugins</a></li>
			<li class="breadcrumb-item"><a href="https://docs.question2answer.org/pages/documentation/plugins/layers">Layers</a></li>
		</ul>
	</div>

	<!-- Section -->
	<section class="article-container">
		<div class="page-container">
		
			<div class="main-content">
				<article class="page-article" itemscope>
					
					<div class="page-directory-navigation">
						<div id="current-dir-nav"></div>
						<ul class="page-sub-directories">
							<li class="page-sub-directory"><a href="https://docs.question2answer.org/pages/documentation/plugins">Plugins</a></li>
							<li class="page-sub-directory"><a href="https://docs.question2answer.org/pages/documentation/plugins/modules">Modules</a></li>
							<li class="page-sub-directory selected-nav"><a href="https://docs.question2answer.org/pages/documentation/plugins/layers">Layers</a></li>
							<li class="page-sub-directory"><a href="https://docs.question2answer.org/pages/documentation/plugins/overrides">Overrides</a></li>
							<li class="page-sub-directory"><a href="https://docs.question2answer.org/pages/documentation/plugins/plugin-tutorial">Plugin Tutorial</a></li>
						</ul>
					</div>
					
					<div class="article-content-container">
						<h1 id="implementing-plugin-layers">Implementing plugin layers</h1>

						<p>A plugin layer can modify the HTML output for any part of a page by overriding functions in <code class="language-plaintext highlighter-rouge">qa_html_theme_base</code>, the base theme class defined in <code class="language-plaintext highlighter-rouge">qa-theme-base.php</code>. The layer is implemented as a PHP file containing the following fixed declaration:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">qa_html_theme_layer</span> <span class="k">extends</span> <span class="nx">qa_html_theme_base</span>
<span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div>

						<p>Layers work similarly to <a href="https://docs.question2answer.org/pages/documentation/themes">advanced themes</a>, except multiple layers can be installed simultaneously via their respective plugins. The PHP code for each layer is automatically modified at runtime (by <code class="language-plaintext highlighter-rouge">qa_load_theme_class()</code> in <code class="language-plaintext highlighter-rouge">qa-app-format.php</code>) to build an inheritance chain of appropriately renamed classes. This process is transparent to you as a layer developer. If you wish to use non English characters in your layer, ensure your text editor is using UTF-8 encoding without a BOM (byte order mark).</p>

						<p>For more information on how to override theme functions in your layer class declaration, <strong>start at step 3</strong> of the documentation for <a href="https://docs.question2answer.org/pages/documentation/themes">advanced themes</a>. When overriding functions in your layer, you should use PHP’s double colon (<code class="language-plaintext highlighter-rouge">::</code>) notation to call through to the parent class as much as possible. This will maximize the chance of your layer working well with advanced themes, layers in other plugins, and future versions of Question2Answer.</p>

						<p>Within a plugin’s layer PHP file, the following pseudo-constants (substituted for strings at runtime) might prove useful:</p>

						<ol>
						  <li><code class="language-plaintext highlighter-rouge">QA_HTML_THEME_LAYER_DIRECTORY</code> contains the full local path of the plugin directory. This can be used as a prefix for <code class="language-plaintext highlighter-rouge">include</code> statements within the layer’s code.</li>
						  <li><code class="language-plaintext highlighter-rouge">QA_HTML_THEME_LAYER_URLTOROOT</code> contains the URL of the plugin directory, relative to the current page request. If the layer outputs HTML that references other files (such as images) within the plugin directory, this prefix should be used for the corresponding URLs.</li>
						</ol>

						<p>Below is an example layer which makes four changes to the standard theme. First, it removes the login and register links if they are to be displayed. Second, it includes a Javascript file from the plugin’s directory on question pages. Third, it displays all question tags in alphabetical order. Fourth, it shows the usernames of specifically priviliged users in italics.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">qa_html_theme_layer</span> <span class="k">extends</span> <span class="nx">qa_html_theme_base</span>
<span class="p">{</span>
	<span class="k">function</span> <span class="nf">nav_list</span><span class="p">(</span><span class="nv">$navigation</span><span class="p">,</span> <span class="nv">$navtype</span><span class="p">,</span> <span class="nv">$level</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="c1">// remove login and register links</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$navtype</span><span class="o">==</span><span class="s1">'nav-user'</span><span class="p">)</span> <span class="p">{</span>
			<span class="nb">unset</span><span class="p">(</span><span class="nv">$navigation</span><span class="p">[</span><span class="s1">'login'</span><span class="p">]);</span>
			<span class="nb">unset</span><span class="p">(</span><span class="nv">$navigation</span><span class="p">[</span><span class="s1">'register'</span><span class="p">]);</span>
		<span class="p">}</span>

		<span class="nx">qa_html_theme_base</span><span class="o">::</span><span class="na">nav_list</span><span class="p">(</span><span class="nv">$navigation</span><span class="p">,</span> <span class="nv">$navtype</span><span class="p">,</span> <span class="nv">$level</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">function</span> <span class="nf">head_script</span><span class="p">()</span> <span class="c1">// add a Javascript file from plugin directory</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">template</span><span class="o">==</span><span class="s1">'question'</span><span class="p">)</span> <span class="c1">// check it's a question page</span>
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">content</span><span class="p">[</span><span class="s1">'script'</span><span class="p">][]</span><span class="o">=</span><span class="s1">'&lt;SCRIPT src="'</span><span class="o">.</span>
			<span class="nx">qa_html</span><span class="p">(</span><span class="nx">QA_HTML_THEME_LAYER_URLTOROOT</span><span class="o">.</span><span class="s1">'my-script.js'</span><span class="p">)</span><span class="o">.</span>
			<span class="s1">'" TYPE="text/javascript"&gt;&lt;/SCRIPT&gt;'</span><span class="p">;</span>

		<span class="nx">qa_html_theme_base</span><span class="o">::</span><span class="na">head_script</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="k">function</span> <span class="nf">post_tag_list</span><span class="p">(</span><span class="nv">$post</span><span class="p">,</span> <span class="nv">$class</span><span class="p">)</span> <span class="c1">// show tags in alphabetical order</span>
	<span class="p">{</span>
		<span class="nb">sort</span><span class="p">(</span><span class="nv">$post</span><span class="p">[</span><span class="s1">'q_tags'</span><span class="p">],</span> <span class="nx">SORT_STRING</span><span class="p">);</span>

		<span class="nx">qa_html_theme_base</span><span class="o">::</span><span class="na">post_tag_list</span><span class="p">(</span><span class="nv">$post</span><span class="p">,</span> <span class="nv">$class</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">function</span> <span class="nf">post_meta_who</span><span class="p">(</span><span class="nv">$post</span><span class="p">,</span> <span class="nv">$class</span><span class="p">)</span> <span class="c1">// show usernames of privileged users in italics</span>
	<span class="p">{</span>
		<span class="k">require_once</span> <span class="nx">QA_INCLUDE_DIR</span><span class="o">.</span><span class="s1">'qa-app-users.php'</span><span class="p">;</span> <span class="c1">// for QA_USER_LEVEL_BASIC constant</span>

		<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$post</span><span class="p">[</span><span class="s1">'raw'</span><span class="p">][</span><span class="s1">'opostid'</span><span class="p">]))</span> <span class="c1">// if item refers to an answer or comment...</span>
			<span class="nv">$level</span><span class="o">=@</span><span class="nv">$post</span><span class="p">[</span><span class="s1">'raw'</span><span class="p">][</span><span class="s1">'olevel'</span><span class="p">];</span> <span class="c1">// ...take the level of answer or comment author</span>
		<span class="k">else</span>
			<span class="nv">$level</span><span class="o">=@</span><span class="nv">$post</span><span class="p">[</span><span class="s1">'raw'</span><span class="p">][</span><span class="s1">'level'</span><span class="p">];</span> <span class="c1">// otherwise take level of the question author</span>

		<span class="k">if</span> <span class="p">(</span><span class="nv">$level</span><span class="o">&gt;</span><span class="nx">QA_USER_LEVEL_BASIC</span><span class="p">)</span> <span class="c1">// if level is more than basic user...</span>
			<span class="nv">$post</span><span class="p">[</span><span class="s1">'who'</span><span class="p">][</span><span class="s1">'data'</span><span class="p">]</span><span class="o">=</span><span class="s1">'&lt;I&gt;'</span><span class="o">.@</span><span class="nv">$post</span><span class="p">[</span><span class="s1">'who'</span><span class="p">][</span><span class="s1">'data'</span><span class="p">]</span><span class="o">.</span><span class="s1">'&lt;/I&gt;'</span><span class="p">;</span> <span class="c1">// ...add italics</span>

		<span class="nx">qa_html_theme_base</span><span class="o">::</span><span class="na">post_meta_who</span><span class="p">(</span><span class="nv">$post</span><span class="p">,</span> <span class="nv">$class</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

					</div>
				</article>
			</div>
			
			<div class="sidebar">
				<ul class="docs-nav">
					<!-- Will Populate -->
				</ul>
			</div>
			
		</div>
	</section>
	
	<div class="jump-top-container">
		<div id="jump-top" class="jump-top"><span class="material-icons">arrow_upward</span></div>
	</div>
	
	<footer class="footer">
		<nav class="footer-nav">
			<ul class="footer-main-nav">
				<li>
					<a href="https://www.question2answer.org/" class="footer-site-logo">
						<img src="../../../images/branding/question2answer-logo-350x40.png">
					</a>
				</li>
				<li><a href="https://www.question2answer.org/feedback.php">Send feedback</a></li>
				<li><a href="https://www.question2answer.org/versions.php">Version history</a></li>
				<li><a href="https://www.question2answer.org/license.php">License details</a></li>
				<li><a href="http://demo.question2answer.org/">Demo sandbox</a></li>
			</ul>
			<div class="footer-credits-nav">
				Created by <a href="http://www.gidgreen.com">Gideon Greenspan</a> and <a href="https://github.com/q2a/question2answer/graphs/contributors">Contributors</a>.
			</div>
		</nav>
	</footer>

	<!-- Javascript main files -->
	<script src="../../../js/sticky_bar.js"></script>
	<script src="../../../js/main.js"></script>
	<script src="../../../js/highlight.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
  
	<!-- Scripts rom Q2A Docs - Classic version -->
	<script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script>
	<script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=UA-1165533-8&amp;l=dataLayer&amp;cx=c">
	</script><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js">
	</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-1974891-11"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-1974891-11');
		gtag('config', 'UA-1165533-8'); // old tracking ID
	</script>

</body>

</html>